// stackgrid.adem.coffee - adwm.co
// Licensed under the MIT license - http://opensource.org/licenses/MIT
// Copyright (C) 2015 Andrew Prasetya
(function(){!function(){return this.Stackgrid=function(){var t,n,i,e,o;return e={height:0,width:0},(e.update=function(){this.height=window.innerHeight,this.width=window.innerWidth})(),i={debounceTimeout:void 0,debounce:function(t,n){clearTimeout(this.debounceTimeout),this.debounceTimeout=window.setTimeout(t,n)},complete:function(){}},t={$container:void 0,$items:void 0,container:{height:0,width:0},items:[],columnPointer:0,numberOfColumns:0,updateSelectors:function(){},updateItems:function(){},updateNumberOfColumns:function(){},scaleContainer:function(){},plot:function(){},stack:function(){}},t.updateSelectors=function(){this.$container=document.querySelector(o.config.containerSelector),this.$items=document.querySelectorAll(o.config.containerSelector+" > "+o.config.itemSelector)},t.updateItems=function(){var t,n,i,e,c,u;if(this.$items.length>0)for(u=this.$items,t=e=0,c=u.length;c>e;t=++e)n=u[t],n.style.width=o.config.columnWidth+"px",i=n.offsetHeight,this.items[t]=[n,i,0,0]},t.updateNumberOfColumns=function(){o.config.isFluid?this.numberOfColumns=Math.floor((e.width-o.config.gutter)/(o.config.columnWidth+o.config.gutter)):this.numberOfColumns=o.config.numberOfColumns,this.numberOfColumns>this.items.length&&(this.numberOfColumns=this.items.length)},t.scaleContainer=function(t){var n,i;this.items.length<this.numberOfColumns?this.container.width=(o.config.columnWidth+o.config.gutter)*this.items.length:this.container.width=(o.config.columnWidth+o.config.gutter)*this.numberOfColumns,n=this.container.height+o.config.gutter,i=this.container.width+o.config.gutter,o.config.scale(this.$container,i,n,t)},t.plot=function(){this.scaleContainer(function(t){return function(){var n,i,e,c,u,s,r;for(s=t.items,r=[],i=c=0,u=s.length;u>c;i=++c)e=s[i],n=function(){},r.push(o.config.move(e[0],e[2],e[3],n));return r}}(this))},t.stack=function(){this.updateNumberOfColumns(),n[o.config.layout].setup(),this.items.length>0&&n[o.config.layout].loop(),this.plot()},n={ordinal:{stack:[],setup:function(){var n;this.stack=function(){var i,e,o,c;for(c=[],n=i=0,e=t.numberOfColumns-1;e>=0?e>=i:i>=e;n=e>=0?++i:--i)c.push((o=0,n=o[0],o));return c}()},plot:function(n){t.items[n][2]=o.config.gutter+(o.config.columnWidth+o.config.gutter)*t.columnPointer,t.items[n][3]=o.config.gutter+this.stack[t.columnPointer],this.stack[t.columnPointer]+=t.items[n][1]+o.config.gutter,this.stack[t.columnPointer]>t.container.height&&(t.container.height=this.stack[t.columnPointer]),t.columnPointer++,t.columnPointer>=t.numberOfColumns&&(t.columnPointer=0)},loop:function(){var n,i,e;for(n=i=0,e=t.items.length-1;e>=0?e>=i:i>=e;n=e>=0?++i:--i)this.plot(n)}},optimized:{stack:[],setup:function(){var n;this.stack=function(){var i,e,o,c;for(c=[],n=i=0,e=t.numberOfColumns-1;e>=0?e>=i:i>=e;n=e>=0?++i:--i)c.push((o=[n,0],n=o[0],o));return c}()},plot:function(n){t.items[n][2]=o.config.gutter+(o.config.columnWidth+o.config.gutter)*this.stack[0][0],t.items[n][3]=o.config.gutter+this.stack[0][1],this.stack[0][1]+=t.items[n][1]+o.config.gutter,this.stack[0][1]>t.container.height&&(t.container.height=this.stack[0][1]),this.stack.sort(function(t,n){return t[1]-n[1]}),t.columnPointer++,t.columnPointer>=t.numberOfColumns&&(t.columnPointer=0)},loop:function(){var n,i,e;for(n=i=0,e=t.items.length-1;e>=0?e>=i:i>=e;n=e>=0?++i:--i)this.plot(n)}}},i.complete=function(){t.stack()},o={config:{containerSelector:void 0,itemSelector:void 0,columnWidth:320,gutter:20,isFluid:!1,layout:"ordinal",numberOfColumns:4,resizeDebounceDelay:350}},o.config.move=function(t,n,i,e){t.style.left=n+"px",t.style.top=i+"px",e()},o.config.scale=function(t,n,i,e){t.style.height=i+"px",t.style.width=n+"px",e()},o.initialize=function(n,o){e.update(),window.addEventListener("resize",function(t){return function(){e.update(),i.debounce(i.complete,t.config.resizeDebounceDelay)}}(this)),this.config.containerSelector=n,this.config.itemSelector=o,t.updateSelectors(),t.updateItems(),t.stack()},o.reset=function(){t.container={width:0,height:0},t.items=[],t.container.height=0,t.columnPointer=0,t.updateSelectors(),t.updateItems()},o.restack=function(){t.stack()},o}}()}).call(this);
